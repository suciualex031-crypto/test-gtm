<!DOCTYPE html>
<html lang="ro">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T6SFWCNT');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Expert | Final Purchase Lab</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #030712; --card: #111827; --primary: #00ffaa; --secondary: #6366f1; --wapp: #25D366; --text: #f9fafb; --danger: #ef4444; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: var(--text); min-height: 200vh; display: flex; flex-direction: column; align-items: center; padding-top: 40px; }
        
        #scroll-progress { position: fixed; top: 0; left: 0; width: 0%; height: 4px; background: linear-gradient(to right, var(--primary), var(--secondary)); z-index: 1000; }
        .container { width: 95%; max-width: 500px; background: var(--card); padding: 30px; border-radius: 28px; border: 1px solid #1f2937; box-shadow: 0 25px 50px rgba(0,0,0,0.6); text-align: center; }
        .ticker { display: flex; justify-content: space-around; background: rgba(0,255,170,0.05); padding: 12px; border-radius: 16px; margin-bottom: 25px; border: 1px solid rgba(0,255,170,0.1); font-size: 0.85rem; font-weight: bold; }
        h1 { font-size: 2.2rem; margin-bottom: 10px; background: linear-gradient(45deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .crypto-card { background: #1f2937; padding: 15px; border-radius: 12px; cursor: pointer; margin-bottom: 10px; border: 1px solid transparent; display: flex; justify-content: space-between; align-items: center; }
        .checkout-step { display: none; padding: 15px; background: rgba(255,255,255,0.02); border-radius: 12px; margin-top: 15px; text-align: left; }
        .active-step { display: block; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0 15px; border-radius: 8px; border: 1px solid #374151; background: var(--bg); color: white; }
        .btn { padding: 14px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; color: white; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: #05070a; }
        .btn-secondary { background: var(--secondary); }
        .btn-danger { background: none; border: 1px solid var(--danger); color: var(--danger); margin-top: 10px; }

        #debug-log { position: fixed; bottom: 15px; right: 15px; width: 220px; max-height: 120px; background: rgba(0,0,0,0.85); border: 1px solid var(--secondary); border-radius: 12px; padding: 10px; font-family: monospace; font-size: 0.7rem; color: var(--primary); overflow-y: auto; z-index: 999; pointer-events: none; }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T6SFWCNT" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div id="scroll-progress"></div>
    <div id="debug-log">Status: Lab Ready...</div>

    <div class="container">
        <div class="ticker">
            <div>BTC: <span id="btc-price" style="color:var(--primary)">$98,432</span></div>
            <div>ETH: <span id="eth-price" style="color:var(--secondary)">$3,120</span></div>
        </div>

        <h1>Crypto Expert</h1>
        <p>Full E-commerce Lifecycle</p>

        <div id="product-list" style="margin-bottom: 20px;">
            <div class="crypto-card" onclick="trackSelect('BTC', 'Bitcoin', 98000)">
                <span>Bitcoin (BTC)</span>
                <button onclick="event.stopPropagation(); trackAddToCart('BTC', 'Bitcoin', 98000)" class="btn btn-primary" style="padding: 5px 10px; font-size: 0.7rem;">BUY</button>
            </div>
            <div class="crypto-card" onclick="trackSelect('ETH', 'Ethereum', 3120)">
                <span>Ethereum (ETH)</span>
                <button onclick="event.stopPropagation(); trackAddToCart('ETH', 'Ethereum', 3120)" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.7rem;">BUY</button>
            </div>
        </div>

        <div id="checkout-container" style="display:none; border: 1px solid #374151; padding: 15px; border-radius: 16px; margin-bottom: 20px;">
            
            <div id="step-cart" class="checkout-step active-step">
                <h3>ðŸ›’ CoÈ™ (View Cart)</h3>
                <div id="cart-items"></div>
                <button onclick="startCheckout()" class="btn btn-primary" style="width:100%; margin-top:10px;">Begin Checkout</button>
            </div>

            <div id="step-payment" class="checkout-step">
                <h3>ðŸ’³ PlatÄƒ & Finalizare</h3>
                <select id="pay-opt"><option value="crypto">Crypto Wallet</option><option value="card">Credit Card</option></select>
                <button onclick="completePurchase()" class="btn btn-primary" style="width:100%;">PLACE ORDER ($)</button>
            </div>

            <div id="step-success" class="checkout-step">
                <h3 style="color:var(--primary)">âœ… Succes!</h3>
                <p id="order-id-display" style="font-size: 0.7rem; margin: 10px 0;"></p>
                <button onclick="processRefund()" class="btn btn-danger" style="width:100%; font-size: 0.7rem;">Cere Refund (Test)</button>
                <button onclick="resetLab()" class="btn btn-secondary" style="width:100%; margin-top:5px;">CumpÄƒrÄƒ din nou</button>
            </div>
        </div>

        <button id="view-cart-btn" onclick="showCart()" style="display:none; width:100%; margin-bottom:15px; background:none; border:1px solid var(--secondary); color:var(--secondary); padding:10px; border-radius:12px; cursor:pointer;">Vezi CoÈ™ul</button>

        <form id="gtm-test-form">
            <input type="text" id="name" placeholder="Nume pentru Lead" required>
            <button type="submit" class="btn btn-secondary" style="width:100%;">Trimite Lead</button>
        </form>
    </div>

    <script>
        let cart = [];
        let lastTransactionId = "";

        function logToScreen(msg) { 
            const log = document.getElementById('debug-log');
            log.innerHTML += `<br>> ${msg}`;
            log.scrollTop = log.scrollHeight;
        }

        // --- ECOMMERCE ACTIONS ---

        function trackSelect(id, name, price) {
            window.dataLayer.push({ event: "select_item", ecommerce: { items: [{ item_id: id, item_name: name, price: price }] } });
            window.dataLayer.push({ event: "view_item", ecommerce: { value: price, items: [{ item_id: id, item_name: name, price: price }] } });
            logToScreen(`Select: ${name}`);
        }

        function trackAddToCart(id, name, price) {
            const item = { item_id: id, item_name: name, price: price, quantity: 1 };
            cart.push(item);
            window.dataLayer.push({ event: "add_to_cart", ecommerce: { value: price, items: [item] } });
            document.getElementById('view-cart-btn').style.display = 'block';
            logToScreen(`Added: ${name}`);
        }

        function showCart() {
            window.dataLayer.push({ event: "view_cart", ecommerce: { value: cart.reduce((s,i)=>s+i.price,0), items: cart } });
            document.getElementById('checkout-container').style.display = 'block';
            const list = document.getElementById('cart-items');
            list.innerHTML = cart.map(i => `<div style="font-size:0.8rem;">${i.item_name} - $${i.price}</div>`).join('');
            showStep('step-cart');
        }

        function startCheckout() {
            window.dataLayer.push({ event: "begin_checkout", ecommerce: { value: cart.reduce((s,i)=>s+i.price,0), items: cart } });
            showStep('step-payment');
        }

        // --- PURCHASE & REFUND ---

        function completePurchase() {
            lastTransactionId = "T_" + Math.floor(Math.random() * 1000000);
            const total = cart.reduce((s,i)=>s+i.price,0);

            window.dataLayer.push({
                event: "purchase",
                ecommerce: {
                    transaction_id: lastTransactionId,
                    value: total,
                    currency: "USD",
                    tax: (total * 0.1).toFixed(2),
                    items: cart
                }
            });

            document.getElementById('order-id-display').innerText = "TranzacÈ›ie ID: " + lastTransactionId;
            showStep('step-success');
            logToScreen(`PURCHASE: ${lastTransactionId}`);
        }

        function processRefund() {
            const total = cart.reduce((s,i)=>s+i.price,0);
            window.dataLayer.push({
                event: "refund",
                ecommerce: {
                    transaction_id: lastTransactionId,
                    value: total,
                    currency: "USD",
                    items: cart
                }
            });
            logToScreen(`REFUND: ${lastTransactionId}`);
            alert("Refund trimis Ã®n GA4!");
        }

        function showStep(id) {
            document.querySelectorAll('.checkout-step').forEach(s => s.classList.remove('active-step'));
            document.getElementById(id).classList.add('active-step');
        }

        function resetLab() { cart = []; document.getElementById('checkout-container').style.display='none'; document.getElementById('view-cart-btn').style.display='none'; }

        document.getElementById('gtm-test-form').addEventListener('submit', (e) => {
            e.preventDefault();
            window.dataLayer.push({ event: "test_form_submit" });
            logToScreen("Form Sent");
        });

        setInterval(() => {
            const btc = 98000 + Math.random() * 500;
            document.getElementById('btc-price').innerText = '$' + btc.toLocaleString();
        }, 3000);
    </script>
</body>
</html>
